# SnapKarte (LineAssist) 導入設定マニュアル

美容室向けLINE連携CRM「SnapKarte」をご利用いただきありがとうございます。
以下の手順に沿って、LINE公式アカウントとアプリの連携設定を行ってください。
所要時間は約10〜15分です。

---

## STEP 1: アカウント作成

1. アプリのログイン画面 (`/login`) にアクセスします。
2. **「新規登録」** タブを選択し、以下の情報を入力してアカウントを作成します。
   - **店舗名**: お店の名前（アプリ内で表示されます）
   - **メールアドレス**: ログイン用IDになります
   - **パスワード**: 任意のパスワード

---

## STEP 2: LINE公式アカウント情報の準備

LINEと連携するために、「LINE Developers」という開発者向けサイトで設定が必要です。
（※PCでの操作を推奨します）

### 1. LINE Developersにログイン
[LINE Developers コンソール](https://developers.line.biz/console/) にアクセスし、個人のLINEアカウントかビジネスアカウントでログインします。

### 2. チャネルの作成（まだ作成していない場合）
1. **「新規プロバイダー作成」** をクリックし、店舗名などを入力して作成します。
2. **「新規チャネル作成」** をクリックし、**「Messaging API」** を選択します。
3. 必須項目を入力して作成します。
   - チャネル名: LINEで顧客に表示される名前（例: 美容室〇〇）
   - チャネル説明: 簡単な説明（例: 予約・来店管理用）
   - 大業種・小業種: 該当するものを選択

### 3. 設定に必要な情報の取得
作成しチャネルの管理画面で、以下の情報を取得（コピー）します。

#### A. チャネルアクセストークン
1. **「Messaging API設定」** タブを開きます。
2. 一番下の「チャネルアクセストークン（長期）」の項目へ行き、**「発行」** ボタンを押します。
3. 表示された長い文字列をコピーし、メモ帳などに控えておきます。

#### B. LINE ID (Basic ID)
1. **「Messaging API設定」** タブの上部にある「ボット情報」内の **「ベーシックID」**（`@`から始まるID）を控えます。（プレミアムIDをお持ちの場合はそちらでも可）

---

## STEP 3: アプリ側での設定

1. SnapKarteアプリにログインし、右上の **「設定（歯車アイコン）」** をクリックします。
2. 以下の項目を入力して **「保存する」** をクリックします。
   - **店舗名**: STEP 1で登録した名前
   - **LINE ID**: STEP 2-3-B で控えたID（例: `@123abcd`）
   - **チャネルアクセストークン**: STEP 2-3-A で発行した長い文字列

---

## STEP 4: Webhookの接続（重要）

LINEからアプリへメッセージを届けるための「パイプ」を繋ぐ設定です。

1. アプリの設定画面にある **「Webhook URL」** の欄に表示されているURLをコピーします。
   - 形式: `https://[アプリURL]/api/webhook/line?shop_id=...`
2. 再び **LINE Developers コンソール** に戻ります。
3. **「Messaging API設定」** タブの「Webhook設定」へ行きます。
4. 「Webhook URL」の「編集」を押し、コピーしたURLを貼り付けます。
   - **必ず `Update` を押した後に、「検証」ボタンを押して「成功」と出るか確認してください。**
5. すぐ下にある **「Webhookの利用」** というスイッチを **ON** にします。

### ※ 自動応答メッセージの無効化（推奨）
LINE公式アカウントのデフォルト設定だと、システムからの返信と同時に「メッセージありがとうございます」等の自動応答が流れてしまうことがあります。

1. [LINE Official Account Manager](https://manager.line.biz/) にログインします。
2. 設定するアカウントを選び、右上の **「設定」 > 「応答設定」** を開きます。
3. 以下の通りに設定します。
   - **応答メッセージ**: **オフ**
   - **Webhook**: **オン**

---

## STEP 5: 動作確認

これですべての設定は完了です！

1. SnapKarteのダッシュボード（ホーム画面）に戻ります。
2. **「連携ガイド」** ボタンを押し、QRコードを表示します。
3. ご自身のスマホでQRコードを読み取り、このLINE公式アカウントを **「友だち追加」** してみてください。
4. 以下の挙動になれば成功です。
   - スマホのLINEに「友だち追加ありがとうございます！会員登録が完了しました」というメッセージが届く。
   - アプリの「顧客一覧」画面に、ご自身のアカウントが追加されている。
