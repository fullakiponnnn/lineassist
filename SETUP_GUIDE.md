# LINE公式アカウント 初期設定ガイド (SnapKarte連携)

このガイドでは、美容師向け電子カルテアプリ「SnapKarte」と連携するために必要なLINE公式アカウントの初期設定手順を解説します。

---

## 目次
1. [LINE公式アカウントの作成](#1-line公式アカウントの作成)
2. [Messaging APIの有効化](#2-messaging-apiの有効化)
3. [Webhookの設定](#3-webhookの設定)
4. [自動応答メッセージの設定](#4-自動応答メッセージの設定)
5. [アクセストークンの発行](#5-アクセストークンの発行)
6. [SnapKarteへの連携情報の登録](#6-snapkarteへの連携情報の登録)
7. [【重要】設定代行の場合の注意点](#-重要-設定代行の場合の注意点)

---

## 1. LINE公式アカウントの作成

まずは店舗用のLINE公式アカウントを作成します。すでに作成済みの場合は「2. Messaging APIの有効化」へ進んでください。

1. **[LINE Business ID](https://manager.line.biz/)** にアクセスし、個人のLINEアカウントまたはビジネスアカウントでログインします。
2. 「アカウントリスト」から **[アカウントを作成]** をクリックします。
3. 必須項目を入力します。
    - **アカウント名**: 店舗名 (例: Hair Salon Tokyo)
    - **メールアドレス**: 連絡用メールアドレス
    - **業種**: 美容・理容・サロン > 美容院・ヘアサロン
4. 内容を確認して **[完了]** をクリックします。
5. **[LINE Official Account Managerへ]** をクリックして管理画面を開きます。

---

## 2. Messaging APIの有効化

SnapKarteからメッセージを送信するために、Messaging APIを有効にします。

1. **[LINE Official Account Manager](https://manager.line.biz/)** のトップページ右上の **[設定]** (歯車アイコン) をクリックします。
2. 左メニューの **[Messaging API]** をクリックします。
3. **[Messaging APIを利用する]** ボタンをクリックします。
4. **プロバイダー** を選択または作成します。
    - プロバイダー名: 「SnapKarte」または店舗名を入力 (例: Hair Salon Tokyo)
5. 内容を確認して **[同意する]** をクリックし、設定を完了します。
6. 設定が完了すると、**[LINE Developers]** へのリンクが表示されるのでクリックして移動します。

---

## 3. Webhookの設定

SnapKarteがメッセージを受信・処理できるようにWebhook URLを設定します。

1. **[LINE Developers コンソール](https://developers.line.biz/console/)** に移動し、作成したチャネルを選択します。
2. **[Messaging API設定]** タブをクリックします。
3. 下にスクロールして **[Webhook設定]** を見つけます。
4. **Webhook URL** の **[編集]** をクリックし、以下のURLを入力します。
    - **URL**: `https://www.snapkarte.jp/api/webhook/line?shop_id={あなたのProfile_ID}`
    - ※ `Profile_ID` はSnapKarteの設定画面に記載されています。
5. **[更新]** をクリックします。
6. 「Webhookの利用」のスイッチを **オン** にします。
7. **[検証]** ボタンを押して、「成功」と表示されることを確認します（※SnapKarte側で設定完了後のみ成功します）。

---

## 4. 自動応答メッセージの設定

Botが対応中にLINE公式アカウントの標準機能による自動応答が邪魔をしないように設定します。

1. **[LINE Official Account Manager](https://manager.line.biz/)** に戻り、左メニューの **[応答設定]** をクリックします。
2. 基本設定を以下のように変更します。
    - **応答モード**: **Bot**
    - **あいさつメッセージ**: オン (任意ですが、SnapKarte側で制御する場合はオフ推奨)
    - **自動応答メッセージ**: **オフ** (必須)
    - **Webhook**: **オン** (必須)
3. 変更は自動保存されます。

---

## 5. アクセストークンの発行

SnapKarteに登録するための認証キー（アクセストークン）を取得します。

1. **[LINE Developers コンソール](https://developers.line.biz/console/)** に戻ります。
2. **[Messaging API設定]** タブの一番下にある **[チャネルアクセストークン（長期）]** を見つけます。
3. **[発行]** ボタンをクリックします。
4. 表示された非常に長い文字列をコピーし、安全な場所に保管します。

---

## 6. SnapKarteへの連携情報の登録

最後に、取得した情報をSnapKarteアプリに入力します。

1. SnapKarteアプリの **[設定]** (歯車アイコン) を開きます。
2. **LINE連携設定** 項目に以下の情報を入力します。
    - **チャネルアクセストークン**: 手順5で発行した長い文字列
    - **チャネルシークレット**: LINE Developersの **[チャネル基本設定]** タブにある文字列
3. **[保存する]** をクリックします。
4. LINE公式アカウントを友だち追加して、正しく動作するかテストします。

---

## ⚠️ 【重要】設定代行の場合の注意点

店舗スタッフやオーナーに代わって設定を行う場合（初期導入サポートなど）、以下の点に注意してください。

### 1. アカウント権限の譲渡
- 設定作業は代行者のLINEアカウントで行うことが一般的ですが、設定完了後は必ず**オーナー（店舗管理者）に権限を付与・譲渡**してください。
- **手順**:
    1. LINE Official Account Managerの **[設定] > [権限管理]** をクリック。
    2. **[メンバーを追加]** をクリック。
    3. 権限の種類を **[管理者]** に設定し、招待リンクを発行してオーナーに送ります。
    4. オーナーが承認した後、代行者のアカウントを削除するか、**[運用担当者]** に降格させてください。

### 2. LINE Developersの権限
- Messaging APIの設定（LINE Developers）も同様に権限管理が必要です。
- **手順**:
    1. LINE Developersコンソールのチャネル設定画面で **[権限管理]** タブをクリック。
    2. オーナーのLINEアカウントを **Admin** として追加します。
    3. オーナーがログインできることを確認してください。

### 3. セキュリティとプライバシー
- **チャネルアクセストークン** や **チャネルシークレット** は漏洩するとアカウントが乗っ取られる危険があります。
- これらをメールやLINEのトーク画面に直接貼り付けて送るのは避け、SnapKarteの設定画面に直接入力するか、パスワード付きファイルで共有するなど、安全な方法で管理してください。
- 代行完了後は、必ず「設定完了したため、以降の管理はお客様にお願いします」と明確に伝えてください。

### 4. 支払い設定 (Stripe)
- SnapKarteの月額料金などの支払い情報は、必ず**オーナー自身のクレジットカード**で登録してもらってください。
- 代行者が自分のカードで登録すると、引き継ぎトラブルや誤請求の原因になります。
